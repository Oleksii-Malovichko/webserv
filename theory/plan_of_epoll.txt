–î–∞ üëç —Ç—ã **–ø–æ–Ω—è–ª –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ**. –ü–ª–∞–Ω —É —Ç–µ–±—è —É–∂–µ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–π. –Ø –ª–∏—à—å **—á—É—Ç—å-—á—É—Ç—å —É—Ç–æ—á–Ω—é –∏ –¥–æ–ø–æ–ª–Ω—é**, —á—Ç–æ–±—ã –æ–Ω —Å—Ç–∞–ª *–∏–¥–µ–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–Ω–æ –¥–ª—è 42 / webserv*.

–ù–∏–∂–µ ‚Äî –æ—Ç–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ + –≤–∞–∂–Ω—ã–µ –º–µ–ª–æ—á–∏, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—Å—Ç–æ —É–ø—É—Å–∫–∞—é—Ç.

---

## ‚úÖ –¢–≤–æ–π –ø–ª–∞–Ω ‚Äî –≤–µ—Ä–µ–Ω. –í–æ—Ç —É—Ç–æ—á–Ω—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è

### üîπ –≠—Ç–∞–ø 1. –ë–∞–∑–æ–≤—ã–π TCP —Å–µ—Ä–≤–µ—Ä (blocking)

**–¶–µ–ª—å:** –ø–æ–Ω—è—Ç—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

–¢—ã –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å –Ω–∞–ø–∏—Å–∞—Ç—å —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π:

* –ø—Ä–∏–Ω–∏–º–∞–µ—Ç **1 –∫–ª–∏–µ–Ω—Ç–∞**
* —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
* –æ—Ç–≤–µ—á–∞–µ—Ç
* –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ—à—å –¢–û–õ–¨–ö–û:

```c
socket()
bind()
listen()
accept()
read()
write()
close()
```

–í–∞–∂–Ω–æ:

* `accept()` ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç
* `read()` ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç
* —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ

üëâ –ó–¥–µ—Å—å —Ç—ã –ø–æ–Ω–∏–º–∞–µ—à—å:

* —á—Ç–æ —Ç–∞–∫–æ–µ –∫–ª–∏–µ–Ω—Ç/—Å–µ—Ä–≤–µ—Ä
* —á—Ç–æ —Å–æ–∫–µ—Ç = fd
* –≥–¥–µ –∏–º–µ–Ω–Ω–æ –≤—Å—ë ¬´–≤–∏—Å–Ω–µ—Ç¬ª

---

### üîπ –≠—Ç–∞–ø 2. –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π —Ä–µ–∂–∏–º (`fcntl` + `EAGAIN`)

**–¶–µ–ª—å:** –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –Ω–µ –∑–∞–≤–∏—Å–∞—Ç—å.

–î–æ–±–∞–≤–ª—è–µ—à—å:

```c
fcntl(fd, F_SETFL, O_NONBLOCK);
```

–¢–µ–ø–µ—Ä—å —Ç—ã –¥–æ–ª–∂–µ–Ω:

* —É–≤–∏–¥–µ—Ç—å `read() == -1`
* –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `errno == EAGAIN || errno == EWOULDBLOCK`
* **–ù–ï —Å—á–∏—Ç–∞—Ç—å —ç—Ç–æ –æ—à–∏–±–∫–æ–π**

–í–∞–∂–Ω–æ:

* –ø–æ—Å—Ç–∞–≤–∏—Ç—å `O_NONBLOCK` **–∏ –Ω–∞ server_fd, –∏ –Ω–∞ client_fd**
* –Ω–µ –¥–µ–ª–∞—Ç—å `while (read() > 0)` –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏

üëâ –≠—Ç–æ –∫–ª—é—á –∫ event-driven —Å–µ—Ä–≤–µ—Ä–∞–º.

---

### üîπ –≠—Ç–∞–ø 3. –ú–∏–Ω–∏-—Å–µ—Ä–≤–µ—Ä —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (–ë–ï–ó select)

–≠—Ç–æ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π, –Ω–æ **–æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω—ã–π —à–∞–≥**.

–ü—Ä–∏–º–µ—Ä:

* accept –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–≤
* —Ö—Ä–∞–Ω–∏ –∏—Ö fd –≤ –º–∞—Å—Å–∏–≤–µ
* –ø—Ä–æ–±—É–π —á–∏—Ç–∞—Ç—å –≤—Å–µ—Ö –ø–æ –æ—á–µ—Ä–µ–¥–∏

–¢—ã —É–≤–∏–¥–∏—à—å:

* CPU 100%
* –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ `read()` ‚Üí `EAGAIN`

üëâ –≠—Ç–æ **–º–æ—Ç–∏–≤–∞—Ü–∏—è** –¥–ª—è `select`.

---

### üîπ –≠—Ç–∞–ø 4. `select()` ‚Äî –¢–û–õ–¨–ö–û –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è

–¢—ã –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫–∞–∑–∞–ª:

> ¬´—á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –∫–æ–Ω—Ü–µ–ø—Ü–∏—é¬ª

–¶–µ–ª—å `select`:

* –Ω–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
* –∞ **–ø–æ–Ω—è—Ç—å –∏–¥–µ—é –æ–∂–∏–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π**

–ß—Ç–æ –≤–∞–∂–Ω–æ –ø–æ–Ω—è—Ç—å:

* `fd_set`
* `FD_SET / FD_CLR / FD_ISSET`
* `select()` **–∏–∑–º–µ–Ω—è–µ—Ç fd_set**
* –∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å

–¢—ã –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å:

* –∂–¥–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—ã–π fd (–Ω–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç)
* –∂–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ fd (–¥–∞–Ω–Ω—ã–µ)

‚ùó –ù–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π. –ù–µ –∫—Ä–∞—Å–∏–≤–æ ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ.

---

### üîπ –≠—Ç–∞–ø 5. `epoll` (—É–∂–µ —Å–µ—Ä—å—ë–∑–Ω–æ)

–¢–æ–ª—å–∫–æ —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏—à—å –∫:

```c
epoll_create1()
epoll_ctl()
epoll_wait()
```

–ó–¥–µ—Å—å —Ç—ã:

* –ø–µ—Ä–µ—Å—Ç–∞—ë—à—å –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å fd –∫–∞–∂–¥—ã–π —Ä–∞–∑
* —Ä–∞–±–æ—Ç–∞–µ—à—å —Ç–æ–ª—å–∫–æ —Å ¬´–≥–æ—Ç–æ–≤—ã–º–∏¬ª —Å–æ–±—ã—Ç–∏—è–º–∏
* –≤–∏–¥–∏—à—å, –∫–∞–∫ –¥–µ–ª–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã

---

## üîß –ß—Ç–æ —Ç—ã –ù–ï —É–ø–æ–º—è–Ω—É–ª, –Ω–æ —ç—Ç–æ –≤–∞–∂–Ω–æ

### ‚ö†Ô∏è 1. `setsockopt(SO_REUSEADDR)`

–ë–µ–∑ —ç—Ç–æ–≥–æ:

* —Å–µ—Ä–≤–µ—Ä —á–∞—Å—Ç–æ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
* `bind()` –ø–∞–¥–∞–µ—Ç

–î–æ–±–∞–≤—å –Ω–∞ —ç—Ç–∞–ø–µ 1:

```c
int opt = 1;
setsockopt(server_fd, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt));
```

---

### ‚ö†Ô∏è 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ `read() == 0`

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç:

> –∫–ª–∏–µ–Ω—Ç –∑–∞–∫—Ä—ã–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:

```c
if (bytes == 0)
    close(client_fd);
```

---

### ‚ö†Ô∏è 3. –ß–∞—Å—Ç–∏—á–Ω—ã–µ —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏

–í–∞–∂–Ω–æ –ø–æ–Ω—è—Ç—å:

* `read()` –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å **–º–µ–Ω—å—à–µ, —á–µ–º —Ç—ã –æ–∂–∏–¥–∞–µ—à—å**
* `write()` –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å **–Ω–µ –≤—Å—ë**

–≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è webserv.

---

### ‚ö†Ô∏è 4. `errno` ‚Äî —ç—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞ –≤—Å–µ–≥–¥–∞

–¢—ã –¥–æ–ª–∂–µ–Ω —á—ë—Ç–∫–æ —Ä–∞–∑–ª–∏—á–∞—Ç—å:

* ‚ùå —Ä–µ–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞
* ‚úÖ `EAGAIN` / `EWOULDBLOCK`

---

### ‚ö†Ô∏è 5. Level-triggered vs Edge-triggered (–ü–û–¢–û–ú)

–ù–µ —Å–µ–π—á–∞—Å.
–ù–æ –∑–Ω–∞–π:

* –Ω–∞—á–∏–Ω–∞–π —Å **level-triggered**
* `EPOLLET` –¥–æ–±–∞–≤–∏—à—å –ø–æ–∑–∂–µ

---

## üß† –ò—Ç–æ–≥ ‚Äî —Ç–≤–æ–π –ø–ª–∞–Ω –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ

```
1 –∫–ª–∏–µ–Ω—Ç (blocking)
‚Üí non-blocking + EAGAIN
‚Üí –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –±–µ–∑ multiplexing
‚Üí select (–ø–æ–Ω—è—Ç—å –∏–¥–µ—é)
‚Üí epoll (—Ä–µ–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)
```

–¢—ã –∏–¥—ë—à—å **–∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø—É—Ç—ë–º** üëå
–û—á–µ–Ω—å –≤–∑—Ä–æ—Å–ª—ã–π –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥.

---

## üöÄ –ß—Ç–æ –ø—Ä–µ–¥–ª–∞–≥–∞—é –¥–∞–ª—å—à–µ

–Ø –º–æ–≥—É:
1Ô∏è‚É£ –¥–∞—Ç—å **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π TCP —Å–µ—Ä–≤–µ—Ä (20‚Äì30 —Å—Ç—Ä–æ–∫)**
2Ô∏è‚É£ —Ä–∞–∑–æ–±—Ä–∞—Ç—å `fcntl + EAGAIN` –Ω–∞ –∂–∏–≤–æ–º –∫–æ–¥–µ
3Ô∏è‚É£ –Ω–∞–ø–∏—Å–∞—Ç—å `select`-—Å–µ—Ä–≤–µ—Ä –∏ –æ–±—ä—è—Å–Ω–∏—Ç—å –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É
4Ô∏è‚É£ –∑–∞—Ç–µ–º ‚Äî —Ç–∞–∫–æ–π –∂–µ –Ω–∞ `epoll`

–°–∫–∞–∂–∏ üëâ **—Å –∫–∞–∫–æ–≥–æ —à–∞–≥–∞ –Ω–∞—á–Ω—ë–º –∫–æ–¥–∏—Ç—å**
