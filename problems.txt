–î–∞ ‚Äî **—É —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –µ—Å—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**, –∏ —ç—Ç–æ **–æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å**, –ø–æ—Ç–æ–º—É —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–∏–µ –≤–µ—â–∏ –º–æ–≥—É—Ç –≤—Å–ø–ª—ã—Ç—å –Ω–∞ –∑–∞—â–∏—Ç–µ webserv.

–°—Ä–∞–∑—É —Å–∫–∞–∂—É:
üëâ **–¥–ª—è —É—á–µ–±–Ω–æ–≥–æ epoll-echo —Å–µ—Ä–≤–µ—Ä–∞ –æ–Ω –Ω–æ—Ä–º**,
üëâ **–¥–ª—è webserv (42) ‚Äî –≤ —Ç–µ–∫—É—â–µ–º –≤–∏–¥–µ –æ–Ω –ù–ï –ø–æ–¥—Ö–æ–¥–∏—Ç**.

–†–∞–∑–±–µ—Ä—ë–º **–ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º**: –æ—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∫ –º–µ–Ω–µ–µ –æ—á–µ–≤–∏–¥–Ω—ã–º.

---

# üî¥ 1. –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ø—Ä–æ–±–ª–µ–º–∞: `write()` –±–µ–∑ EPOLLOUT

```cpp
write(fd, buf, nread); // just echo
```

‚ùå **–≠—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –≤ webserv**
‚ùå **–≠—Ç–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω–æ**

### –ü–æ—á–µ–º—É —ç—Ç–æ —É—è–∑–≤–∏–º–æ—Å—Ç—å

* —Å–æ–∫–µ—Ç **–Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø–∏—Å–∏**
* write –º–æ–∂–µ—Ç:

  * –≤–µ—Ä–Ω—É—Ç—å `-1` (EAGAIN)
  * –∑–∞–ø–∏—Å–∞—Ç—å **–º–µ–Ω—å—à–µ, —á–µ–º nread**
* —Ç—ã **–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—à—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç**

üëâ –í webserv —ç—Ç–æ = **0 –±–∞–ª–ª–æ–≤**

### –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

* —Ö—Ä–∞–Ω–∏—Ç—å outgoing buffer
* –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ `EPOLLOUT`
* –ø–∏—Å–∞—Ç—å **—Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ epoll —Å–∫–∞–∑–∞–ª, —á—Ç–æ –º–æ–∂–Ω–æ**

---

# üî¥ 2. –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö (partial read / write)

```cpp
int nread = read(fd, buf, sizeof(buf));
```

‚ùå —Ç—ã —Å—á–∏—Ç–∞–µ—à—å, —á—Ç–æ:

* read —á–∏—Ç–∞–µ—Ç –≤—Å—ë
* write –ø–∏—à–µ—Ç –≤—Å—ë

–≠—Ç–æ **–Ω–µ–≤–µ—Ä–Ω–æ –¥–ª—è TCP**.

### –ê—Ç–∞–∫–∞ / –ø—Ä–æ–±–ª–µ–º–∞

–ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç:

* –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–¥–ª–µ–Ω–Ω–æ
* —Ä–∞–∑–±–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ —á–∞—Å—Ç–∏
* –ø–æ–ª—É—á–∏—Ç—å –±–∏—Ç—ã–π echo

üëâ –î–ª—è HTTP —ç—Ç–æ **—Ñ–∞—Ç–∞–ª—å–Ω–æ**

---

# üî¥ 3. –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç Slowloris (DoS)

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

–ö–ª–∏–µ–Ω—Ç:

* –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è
* –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 1 –±–∞–π—Ç –≤ 10 —Å–µ–∫—É–Ω–¥

–¢–≤–æ–π —Å–µ—Ä–≤–µ—Ä:

* –¥–µ—Ä–∂–∏—Ç fd
* –æ–±–Ω–æ–≤–ª—è–µ—Ç `last_activity`
* **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**

### –ò—Ç–æ–≥

1000 —Ç–∞–∫–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ = —Å–µ—Ä–≤–µ—Ä —É–º–µ—Ä

‚úîÔ∏è –£ —Ç–µ–±—è –µ—Å—Ç—å timeout
‚ùå –ù–æ —Ç—ã –æ–±–Ω–æ–≤–ª—è–µ—à—å –µ–≥–æ **–ø—Ä–∏ –ª—é–±–æ–º read**, –¥–∞–∂–µ 1 –±–∞–π—Ç

### –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

* separate:

  * connection timeout
  * request timeout
* –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –≤—Ä–µ–º—è –Ω–∞ **–ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ HTTP-–∑–∞–ø—Ä–æ—Å–∞**

---

# üî¥ 4. –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤

```cpp
std::unordered_map<int, Client> clients;
```

‚ùå –ù–µ—Ç:

* max connections
* –∑–∞—â–∏—Ç—ã –æ—Ç FD exhaustion

### –ê—Ç–∞–∫–∞

```bash
for i in {1..100000}; do nc localhost 8080 & done
```

üëâ —Å–µ—Ä–≤–µ—Ä —É–ø—Ä—ë—Ç—Å—è –≤:

* –ª–∏–º–∏—Ç fd
* –ø–∞–º—è—Ç—å
* epoll

---

# üî¥ 5. –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ EPOLLERR / EPOLLHUP

```cpp
ev.events = EPOLLIN;
```

‚ùå –¢—ã **–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—à—å**:

* `EPOLLERR`
* `EPOLLHUP`
* `EPOLLRDHUP`

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

* zombie connections
* —É—Ç–µ—á–∫–∏ fd
* –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### –ú–∏–Ω–∏–º—É–º –Ω—É–∂–Ω–æ

```cpp
ev.events = EPOLLIN | EPOLLRDHUP;
```

–ò –ø—Ä–æ–≤–µ—Ä—è—Ç—å:

```cpp
if (events[i].events & (EPOLLHUP | EPOLLERR))
```

---

# üî¥ 6. accept() —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑

```cpp
int client_fd = accept(listen_sock, ...);
```

‚ùå –ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π > 1
epoll —Å–∫–∞–∂–µ—Ç ¬´–º–æ–∂–Ω–æ accept¬ª, –Ω–æ —Ç—ã –≤–æ–∑—å–º—ë—à—å **—Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ**

### –ü—Ä–∞–≤–∏–ª—å–Ω–æ

```cpp
while ((client_fd = accept(...)) >= 0) { ... }
```

---

# üü† 7. –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ EAGAIN / EWOULDBLOCK

```cpp
int nread = read(fd, buf, sizeof(buf));
```

–¢—ã –ø—Ä–æ–≤–µ—Ä—è–µ—à—å:

```cpp
if (nread <= 0)
```

‚ùå –Ω–æ:

* `nread == -1` –∏ `errno == EAGAIN` ‚Üí **–ù–ï –æ—à–∏–±–∫–∞**
* —Ç—ã –∑–∞–∫—Ä–æ–µ—à—å –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

# üü† 8. Echo-—Å–µ—Ä–≤–µ—Ä = –æ—Ç—Ä–∞–∂—ë–Ω–Ω–∞—è –∞—Ç–∞–∫–∞

Echo ‚Äî –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —à—Ç—É–∫–∞ –¥–ª—è:

* amplification
* reflection attacks

–î–ª—è HTTP —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ,
–Ω–æ **–≤ —Ä–µ–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ —ç—Ç–æ –æ–ø–∞—Å–Ω–æ**.

---

# üü† 9. unordered_map + erase –≤–æ –≤—Ä–µ–º—è –∏—Ç–µ—Ä–∞—Ü–∏–∏ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ)

–ó–¥–µ—Å—å —Ç—ã —Å–¥–µ–ª–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

```cpp
it = clients.erase(it);
```

‚úîÔ∏è –ù–æ:

* –µ—Å–ª–∏ –≥–¥–µ-—Ç–æ –¥–æ–±–∞–≤–∏—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å ‚Äî –±—É–¥–µ—Ç –±–æ–ª—å
* –≤ webserv –ª—É—á—à–µ **–≤—Å—ë —á–µ—Ä–µ–∑ –æ–¥–∏–Ω event loop**

---

# üü° 10. –ù–µ—Ç HTTP-–ª–æ–≥–∏–∫–∏ –≤–æ–æ–±—â–µ

–≠—Ç–æ –Ω–µ —É—è–∑–≤–∏–º–æ—Å—Ç—å, –Ω–æ –≤–∞–∂–Ω–æ:

* –Ω–µ—Ç –ª–∏–º–∏—Ç–∞ request size
* –Ω–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
* –Ω–µ—Ç Content-Length
* –Ω–µ—Ç parsing state machine

–î–ª—è webserv —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ.

---

# üß† –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ü—Ä–æ–±–ª–µ–º–∞            | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
| ------------------- | ----------- |
| write –±–µ–∑ EPOLLOUT  | üî¥          |
| partial read/write  | üî¥          |
| Slowloris           | üî¥          |
| –Ω–µ—Ç –ª–∏–º–∏—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ | üî¥          |
| EPOLLERR/HUP        | üî¥          |
| accept() –Ω–µ –≤ —Ü–∏–∫–ª–µ | üî¥          |
| EAGAIN              | üü†          |
| echo                | üü†          |

---

# ‚úÖ –ß—Ç–æ –•–û–†–û–®–û –≤ —ç—Ç–æ–º –∫–æ–¥–µ

‚úî non-blocking sockets
‚úî –æ–¥–∏–Ω epoll
‚úî timeout –ª–æ–≥–∏–∫–∞
‚úî –ø—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
‚úî –ø–æ–Ω—è—Ç–Ω—ã–π –∫–æ–¥

–≠—Ç–æ **–æ—Ç–ª–∏—á–Ω–∞—è –±–∞–∑–∞ –¥–ª—è webserv**, –Ω–æ **–ù–ï —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è**.

---

# üöÄ –ö–∞–∫ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –µ–≥–æ –≤ webserv

–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. —É–±—Ä–∞—Ç—å echo
2. –¥–æ–±–∞–≤–∏—Ç—å input buffer
3. –ø–∞—Ä—Å–∏—Ç—å HTTP –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º
4. output buffer + EPOLLOUT
5. –ª–∏–º–∏—Ç—ã
6. CGI —á–µ—Ä–µ–∑ pipes
7. config

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —è –º–æ–≥—É:

* –ø–æ–∫–∞–∑–∞—Ç—å **–∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å write ‚Üí EPOLLOUT**
* –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä –≤ **webserv-ready skeleton**
* —Ä–∞–∑–æ–±—Ä–∞—Ç—å **Slowloris –∑–∞—â–∏—Ç—É**
* –æ–±—ä—è—Å–Ω–∏—Ç—å **—á—Ç–æ —Å–∫–∞–∂—É—Ç –Ω–∞ –∑–∞—â–∏—Ç–µ**

–°–∫–∞–∂–∏, —á—Ç–æ –¥–µ–ª–∞–µ–º –¥–∞–ª—å—à–µ üëç
